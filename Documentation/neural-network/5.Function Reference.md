# Function Reference

## Overview
This document provides complete API documentation for all functions declared in `linux/neural.h`.

## Core Network Functions

### neural_network_init()
Initialize a neural network structure.

```c
int neural_network_init(neural_network_t *nn, u32 input_size, u32 hidden_size, 
                       u32 output_size, bool use_batch_norm, f32 dropout_rate);
```

**Parameters:**
- `nn`: Pointer to neural network structure
- `input_size`: Number of input neurons (1-4096)
- `hidden_size`: Number of hidden neurons (1-4096)
- `output_size`: Number of output neurons (1-1024)
- `use_batch_norm`: Enable batch normalization
- `dropout_rate`: Dropout rate (0.0-1.0)

**Returns:** 0 on success, negative error code on failure

**Example:**
```c
neural_network_t *nn = kzalloc(sizeof(neural_network_t), GFP_KERNEL);
int ret = neural_network_init(nn, 256, 128, 10, false, 0.2f);
```

### neural_network_cleanup()
Clean up neural network resources.

```c
void neural_network_cleanup(neural_network_t *nn);
```

**Parameters:**
- `nn`: Pointer to neural network structure

**Description:** Frees all allocated memory and resets the network structure.

### neural_network_predict()
Make a prediction using the neural network.

```c
int neural_network_predict(neural_network_t *nn, const s32 *input, s32 *output);
```

**Parameters:**
- `nn`: Pointer to initialized neural network
- `input`: Input data array in fixed-point format
- `output`: Output array to store predictions

**Returns:** 0 on success, negative error code on failure

**Example:**
```c
s32 input[256], output[10];
// Convert data to fixed-point
for (int i = 0; i < 256; i++) input[i] = INT_TO_FP(raw_data[i]);
int ret = neural_network_predict(nn, input, output);
```

### neural_network_predict_cached()
Make a prediction with result caching.

```c
int neural_network_predict_cached(neural_network_t *nn, const s32 *input, s32 *output);
```

**Parameters:**
- `nn`: Pointer to initialized neural network
- `input`: Input data array in fixed-point format
- `output`: Output array to store predictions

**Returns:** 0 on success, negative error code on failure

**Description:** Uses caching to avoid redundant computations for identical inputs.

## Reference Counting Functions

### neural_network_ref()
Increment reference count.

```c
neural_network_t *neural_network_ref(neural_network_t *nn);
```

**Parameters:**
- `nn`: Pointer to neural network structure

**Returns:** Pointer to the neural network or NULL on failure

### neural_network_unref()
Decrement reference count and clean up if zero.

```c
void neural_network_unref(neural_network_t *nn);
```

**Parameters:**
- `nn`: Pointer to neural network structure

**Description:** Automatically cleans up when reference count reaches zero.

## Network Creation Functions

### neural_network_create()
Create and initialize a basic neural network.

```c
neural_network_t* neural_network_create(u32 INPUT_LAYER, u32 HIDDEN_LAYER, u32 OUTPUT_LAYER);
```

**Parameters:**
- `INPUT_LAYER`: Number of input neurons
- `HIDDEN_LAYER`: Number of hidden neurons
- `OUTPUT_LAYER`: Number of output neurons

**Returns:** Pointer to initialized network or NULL on failure

### neural_network_create_advanced()
Create neural network with advanced features.

```c
neural_network_t* neural_network_create_advanced(u32 input_size, u32 hidden_size, u32 output_size,
                                                 bool use_batch_norm, f32 dropout_rate);
```

**Parameters:**
- `input_size`: Number of input neurons
- `hidden_size`: Number of hidden neurons
- `output_size`: Number of output neurons
- `use_batch_norm`: Enable batch normalization
- `dropout_rate`: Dropout rate (0.0-1.0)

**Returns:** Pointer to initialized network or NULL on failure

### neural_network_destroy()
Destroy a neural network.

```c
void neural_network_destroy(neural_network_t *nn);
```

**Parameters:**
- `nn`: Pointer to neural network structure

## Weight Management Functions

### neural_network_set_weights()
Set weights for a specific layer.

```c
int neural_network_set_weights(neural_network_t *nn, u32 layer_idx, s32 *weights, s32 *biases);
```

**Parameters:**
- `nn`: Pointer to neural network
- `layer_idx`: Layer index (0-based)
- `weights`: Weight matrix in fixed-point format
- `biases`: Bias vector in fixed-point format (optional)

**Returns:** 0 on success, negative error code on failure

### neural_network_get_confidence()
Get confidence level of last prediction.

```c
u32 neural_network_get_confidence(neural_network_t *nn);
```

**Parameters:**
- `nn`: Pointer to neural network

**Returns:** Confidence percentage (0-100)

## Layer Functions

### neural_layer_forward()
Forward propagation through a single layer.

```c
int neural_layer_forward(neural_layer_t *layer, const s32 *input);
```

**Parameters:**
- `layer`: Pointer to layer structure
- `input`: Input data array

**Returns:** 0 on success, negative error code on failure

### init_neural_layer()
Initialize a neural layer.

```c
int init_neural_layer(neural_layer_t *layer, u32 input_size, u32 output_size, u8 activation_type);
```

**Parameters:**
- `layer`: Pointer to layer structure
- `input_size`: Number of inputs
- `output_size`: Number of outputs
- `activation_type`: Activation function type (0-4)

**Returns:** 0 on success, negative error code on failure

### free_neural_layer()
Free neural layer memory.

```c
void free_neural_layer(neural_layer_t *layer);
```

**Parameters:**
- `layer`: Pointer to layer structure

## Batch Processing Functions

### neural_batch_create()
Create a batch processing structure.

```c
neural_batch_t* neural_batch_create(u32 batch_size, u32 input_dim, u32 output_dim);
```

**Parameters:**
- `batch_size`: Number of samples in batch
- `input_dim`: Input dimensionality
- `output_dim`: Output dimensionality

**Returns:** Pointer to batch structure or NULL on failure

### neural_batch_destroy()
Destroy a batch processing structure.

```c
void neural_batch_destroy(neural_batch_t *batch);
```

**Parameters:**
- `batch`: Pointer to batch structure

## Model Serialization Functions

### neural_network_save_model()
Save neural network model to memory.

```c
int neural_network_save_model(neural_network_t *nn, u8 **model_data, size_t *model_size);
```

**Parameters:**
- `nn`: Pointer to neural network
- `model_data`: Pointer to store model data
- `model_size`: Pointer to store model size

**Returns:** 0 on success, negative error code on failure

### neural_network_load_model()
Load neural network model from memory.

```c
int neural_network_load_model(neural_network_t *nn, const u8 *model_data, size_t model_size);
```

**Parameters:**
- `nn`: Pointer to neural network
- `model_data`: Model data to load
- `model_size`: Size of model data

**Returns:** 0 on success, negative error code on failure

## Activation Functions

### neural_relu()
ReLU activation function.

```c
s32 neural_relu(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** max(0, x)

### neural_sigmoid()
Sigmoid activation function.

```c
s32 neural_sigmoid(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** 1/(1+e^-x) in fixed-point format

### neural_tanh()
Hyperbolic tangent activation function.

```c
s32 neural_tanh(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** tanh(x) in fixed-point format

### neural_leaky_relu()
Leaky ReLU activation function.

```c
s32 neural_leaky_relu(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** max(0.01*x, x)

### neural_linear()
Linear activation function.

```c
s32 neural_linear(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** x (identity function)

### neural_softmax()
Softmax activation for arrays.

```c
void neural_softmax(s32 *inputs, u32 size);
```

**Parameters:**
- `inputs`: Array of values to normalize (modified in-place)
- `size`: Number of elements in array

## Utility Functions

### neural_hash_input()
Generate hash for input data.

```c
u32 neural_hash_input(const s32 *input, u32 size);
```

**Parameters:**
- `input`: Input data array
- `size`: Size of input array

**Returns:** Hash value for caching

### neural_calculate_layer_memory()
Calculate memory usage of a layer.

```c
size_t neural_calculate_layer_memory(neural_layer_t *layer);
```

**Parameters:**
- `layer`: Pointer to layer structure

**Returns:** Memory usage in bytes

## NUMA Functions

### neural_alloc_numa()
NUMA-aware memory allocation.

```c
void *neural_alloc_numa(size_t size, int node);
```

**Parameters:**
- `size`: Size to allocate
- `node`: NUMA node (-1 for any)

**Returns:** Allocated memory or NULL on failure

### neural_alloc_interleaved()
Interleaved NUMA allocation.

```c
void *neural_alloc_interleaved(size_t size);
```

**Parameters:**
- `size`: Size to allocate

**Returns:** Allocated memory or NULL on failure

## SIMD Functions

### neural_vector_add_simd()
SIMD-optimized vector addition.

```c
void neural_vector_add_simd(const s32 *a, const s32 *b, s32 *result, u32 size);
```

**Parameters:**
- `a`: First input vector
- `b`: Second input vector
- `result`: Output vector
- `size`: Vector size

### neural_vector_dot_simd()
SIMD-optimized dot product.

```c
s32 neural_vector_dot_simd(const s32 *a, const s32 *b, u32 size);
```

**Parameters:**
- `a`: First input vector
- `b`: Second input vector
- `size`: Vector size

**Returns:** Dot product in fixed-point format

## Validation Functions

### neural_validate_input()
Validate input data.

```c
bool neural_validate_input(const s32 *input, u32 size);
```

**Parameters:**
- `input`: Input data array
- `size`: Size of input array

**Returns:** true if valid, false otherwise

### neural_validate_weights()
Validate weight data.

```c
bool neural_validate_weights(const s32 *weights, u32 size);
```

**Parameters:**
- `weights`: Weight data array
- `size`: Size of weight array

**Returns:** true if valid, false otherwise

## Fixed-Point Math Functions

### neural_fp_sqrt()
Fixed-point square root.

```c
s32 neural_fp_sqrt(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** Square root in fixed-point format

### neural_fp_exp()
Fixed-point exponential function.

```c
s32 neural_fp_exp(s32 x);
```

**Parameters:**
- `x`: Input value in fixed-point format

**Returns:** e^x in fixed-point format

## Error Codes

All functions return standard Linux error codes:

| Code | Constant | Description |
|------|----------|-------------|
| 0 | NEURAL_SUCCESS | Success |
| -1 | NEURAL_ERROR_INVALID_INPUT | Invalid input parameters |
| -2 | NEURAL_ERROR_MEMORY | Memory allocation failure |
| -3 | NEURAL_ERROR_INVALID_LAYER | Invalid layer configuration |
| -4 | NEURAL_ERROR_INVALID_MODEL | Invalid model format |
| -5 | NEURAL_ERROR_SIMD_UNAVAILABLE | SIMD not available |
| -6 | NEURAL_ERROR_NUMA_FAILURE | NUMA allocation failure |
| -7 | NEURAL_ERROR_SECURITY_VIOLATION | Security validation failed |
