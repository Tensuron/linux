# Make Simple AI Model

## Overview

This document provides a step-by-step guide to making a simple AI model using the Linux kernel neural network implementation.

## Prerequisites

- Linux kernel source code
- Basic knowledge of AI models
- Basic knowledge of Linux kernel module development

## Get Started

```c
#include <linux/neural.h>

static int create_simple_ai_model(void)
{
    neural_network_t *nn;
    int ret;
    int raw_input[16] = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16};

    // Initialize network: 16 inputs, 8 hidden, 4 outputs
    nn = neural_network_init(16, 8, 4);
    if (IS_ERR(nn)) {
        pr_err("Failed to initialize neural network: %ld\n", PTR_ERR(nn));
        return PTR_ERR(nn);
    }

    // Prepare input data (convert to fixed-point)
    s32 input_data[16];
    s32 output_data[4];
    for (int i = 0; i < 16; i++) {
        input_data[i] = INT_TO_FIXED(raw_input[i]);
    }

    // Make prediction
    ret = neural_network_predict(nn, input_data, output_data, 16, 4);
    if (ret < 0) {
        pr_err("Prediction failed: %d\n", ret);
        neural_network_cleanup(nn);
        return ret;
    }

    // Process results (convert from fixed-point)
    for (int i = 0; i < 4; i++) {
        int result = FIXED_TO_INT(output_data[i]);
        pr_info("Output[%d]: %d\n", i, result);
    }

    // Clean up
    neural_network_cleanup(nn);
    return 0;
}
```

## Complete Module Example

Here's a complete kernel module that demonstrates creating and using a simple AI model:

```c
#include <linux/init.h>
#include <linux/module.h>
#include <linux/kernel.h>
#include <linux/neural.h>

static neural_network_t *global_nn;

static int __init simple_ai_init(void)
{
    int ret;
    s32 test_input[4] = {INT_TO_FIXED(1), INT_TO_FIXED(2), 
                         INT_TO_FIXED(3), INT_TO_FIXED(4)};
    s32 output[2];

    pr_info("Simple AI Model: Initializing...\n");

    // Create a simple 4-8-2 neural network
    global_nn = neural_network_init(4, 8, 2);
    if (IS_ERR(global_nn)) {
        pr_err("Failed to create neural network: %ld\n", PTR_ERR(global_nn));
        return PTR_ERR(global_nn);
    }

    pr_info("Neural network created successfully\n");

    // Test prediction
    ret = neural_network_predict(global_nn, test_input, output, 4, 2);
    if (ret < 0) {
        pr_err("Prediction failed: %d\n", ret);
        neural_network_cleanup(global_nn);
        return ret;
    }

    pr_info("Prediction results: [%d, %d]\n", 
            FIXED_TO_INT(output[0]), FIXED_TO_INT(output[1]));

    return 0;
}

static void __exit simple_ai_exit(void)
{
    pr_info("Simple AI Model: Cleaning up...\n");
    
    if (global_nn) {
        neural_network_cleanup(global_nn);
        global_nn = NULL;
    }
    
    pr_info("Simple AI Model: Unloaded\n");
}

module_init(simple_ai_init);
module_exit(simple_ai_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Your Name");
MODULE_DESCRIPTION("Simple AI Model Example");
MODULE_VERSION("1.0");
```

## Building and Testing

### Makefile

Create a `Makefile` for your module:

```makefile
obj-m += simple_ai.o

all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean

install:
	sudo insmod simple_ai.ko

remove:
	sudo rmmod simple_ai

test: install
	dmesg | tail -10
	$(MAKE) remove
```

### Build and Load

```bash
# Build the module
make

# Load the module
sudo insmod simple_ai.ko

# Check the output
dmesg | tail -10

# Unload the module
sudo rmmod simple_ai
```

## Key Points

1. **Initialization**: Use `neural_network_init()` to create the network
2. **Fixed-Point Conversion**: Convert integers using `INT_TO_FIXED()` and `FIXED_TO_INT()`
3. **Error Handling**: Always check return values and handle errors properly
4. **Memory Management**: Use `neural_network_cleanup()` to free resources
5. **Module Structure**: Follow standard kernel module patterns with `__init` and `__exit`

## Next Steps

- [Train Simple AI Model](11.Train%20Simple%20AI%20Model.md) - Learn how to train your model
- [Deploy Simple AI Model](12.Deploy%20Simple%20AI%20Model.md) - Deploy your model in production
- [Test Simple AI Model](13.Test%20Simple%20AI%20Model.md) - Comprehensive testing strategies